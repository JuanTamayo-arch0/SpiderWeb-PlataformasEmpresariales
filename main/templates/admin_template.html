{% extends 'base.html' %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Admin page - Spider Web{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>

  {% block content %}

    <div class="onlyauth">
        <div class="ct">
            <h1>Variantes de Spider-Man</h1>
        </div>
  
        <form method="get" id="filterForm">
          <input type="text" name="q" placeholder="Buscar por nombre" value="{{ nombre }}">
          <input type="text" name="descripcion" placeholder="Buscar por descripción" value="{{ descripcion }}">
        
          <label for="orden">Ordenar:</label>
          <select name="orden" id="orden" onchange="document.getElementById('filterForm').submit();">
            <option value="asc" {% if orden == 'asc' %}selected{% endif %}>A-Z</option>
            <option value="desc" {% if orden == 'desc' %}selected{% endif %}>Z-A</option>
          </select>
        
          <label for="cantidad">Mostrar:</label>
          <select name="cantidad" id="cantidad" onchange="document.getElementById('filterForm').submit();">
            <option value="3" {% if cantidad == '3' %}selected{% endif %}>3</option>
            <option value="6" {% if cantidad == '6' %}selected{% endif %}>6</option>
            <option value="9" {% if cantidad == '9' %}selected{% endif %}>9</option>
            <option value="12" {% if cantidad == '12' %}selected{% endif %}>12</option>
          </select>
        
          <button type="submit">Aplicar Filtros</button>
        
          <!-- Botón de limpiar -->
          <a href="{% url 'admin_only' %}" class="btn-clear">Limpiar Filtros</a>
        </form>

        <div class="container" id="spiderman-container">
            {% for v in page_obj %}
            <div class="card">
                <img src="{{ v.imagen }}" alt="{{ v.nombre }}">
                <h3>{{ v.nombre }}</h3>
                <p>{{ v.descripcion }}</p>
                <div class="btns">
                    <div class="btn-l">
                        <a href="{% url 'editar_variant' v.id %}" class="btn-edit">Editar</a>
                    </div>
                    <div class="btn-r">
                        <form method="POST" class="btn-d" action="{% url 'eliminar_variant' v.id %}">
                            {% csrf_token %}
                            <button type="submit" class="btn-delete">Eliminar</button>
                        </form>
                    </div>
                </div>
            </div>
            {% empty %}
                <p>No se encontraron variantes de Spider-Man con ese nombre.</p>
            {% endfor %}
        </div>
        <div class="pagination">
            <span class="step-links">
              {% if page_obj.has_previous %}
                <a href="?{% if query %}q={{ query }}&{% endif %}page=1">&laquo; primero</a>
                <a href="?{% if query %}q={{ query }}&{% endif %}page={{ page_obj.previous_page_number }}">anterior</a>
              {% endif %}
          
              <span class="current">
                Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
              </span>
          
              {% if page_obj.has_next %}
                <a href="?{% if query %}q={{ query }}&{% endif %}page={{ page_obj.next_page_number }}">siguiente</a>
                <a href="?{% if query %}q={{ query }}&{% endif %}page={{ page_obj.paginator.num_pages }}">última &raquo;</a>
              {% endif %}
            </span>
          </div>
  
        <div class="addel">
          <div class="form-div" id="contacto">
            <div class="left-side">
              <h1>Agregar Elemento</h1>
              <form method="POST" action="{% url 'agregar_variant' %}">
                {% csrf_token %}
                <div class="dog">
                  <input name="imagen" type="text" placeholder="Url Imagen" required>
                </div>
                <div class="dog">
                  <input name="nombre" type="text" placeholder="Nombre spiderman" required>
                </div>
                <div class="dog">
                  <input name="datos" type="text" placeholder="Datos spiderman" required>
                </div>
                <div class="dog">
                  <textarea name="descripcion" placeholder="Descripción spiderman" required></textarea>
                </div>
                <button type="submit" id="add1">Agregar</button>
              </form>
            </div>
        </div>
      </div>

      <div id="confirmModal" class="modal">
        <div class="modal-content">
          <p>¿Estás seguro de que quieres eliminar el elemento?</p>
          <button id="confirmBtn" class="btn confirm">Confirmar</button>
          <button id="cancelBtn" class="btn cancel">Cancelar</button>
        </div>
      </div>
      
      <script>
        const deleteForms = document.querySelectorAll('.btn-d');
        const modal = document.getElementById('confirmModal');
        const confirmBtn = document.getElementById('confirmBtn');
        const cancelBtn = document.getElementById('cancelBtn');
      
        let currentForm = null; // Para guardar el formulario que se quiere enviar
      
        deleteForms.forEach(form => {
          form.addEventListener('submit', function(e) {
            e.preventDefault(); // Prevenir envío inmediato
            currentForm = form; // Guardar el formulario actual
            modal.style.display = 'block'; // Mostrar modal
          });
        });
      
        confirmBtn.addEventListener('click', function() {
          modal.style.display = 'none';
          if (currentForm) currentForm.submit(); // Enviar el formulario si se confirma
        });
      
        cancelBtn.addEventListener('click', function() {
          modal.style.display = 'none'; // Cerrar modal sin enviar
          currentForm = null;
        });
      </script>
      
      {% endblock %}

</body>
</html>